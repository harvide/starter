# Polar Integration

[Polar](https://polar.sh) is a platform for open source monetization, allowing you to accept sponsorships and manage subscriptions for your open source projects. Harvide Starter provides built-in integration with Polar.

## Initial Setup

1. **Environment Variables**
   ```bash
   POLAR_TOKEN=polar_...
   POLAR_ORGANIZATION=your-org
   ```

## Configuration

Configure Polar in your `starter.config.ts`:

```typescript
export default {
  payments: {
    polar: {
      enabled: true,
      organization: process.env.POLAR_ORGANIZATION,
      subscriptions: {
        enabled: true,
        defaultTiers: [
          {
            name: "Supporter",
            price: 5,
            benefits: ["Support our work", "Early access"]
          },
          {
            name: "Sponsor",
            price: 20,
            benefits: ["Priority support", "Custom badge"]
          }
        ]
      },
      badges: {
        enabled: true,
        showInProfile: true
      }
    }
  }
}
```

## Features

### Sponsorship Management

- Multiple sponsorship tiers
- Monthly and yearly subscriptions
- One-time donations
- Sponsor badges
- Benefit tracking

### Open Source Integration

- GitHub integration
- Repository linking
- Issue tracking
- Dependency detection
- Funding allocation

### Community Features

- Sponsor recognition
- Custom badges
- Activity tracking
- Public profile

## Implementation

### 1. Set Up Subscription Tiers

```typescript
// Example: Defining subscription tiers
const tiers = [
  {
    name: "Community",
    price: 5,
    period: "monthly",
    benefits: [
      "Support open source",
      "Community recognition"
    ]
  },
  {
    name: "Professional",
    price: 25,
    period: "monthly",
    benefits: [
      "Priority support",
      "Early access to features",
      "Custom development"
    ]
  }
];
```

### 2. Handle Webhooks

```typescript
// Example: Webhook handler for Polar events
export async function POST(req: Request) {
  const event = await polar.webhooks.constructEvent(
    await req.text(),
    req.headers.get("polar-signature"),
    process.env.POLAR_WEBHOOK_SECRET
  );

  switch (event.type) {
    case "subscription.created":
      // Handle new subscription
      break;
    case "subscription.cancelled":
      // Handle cancellation
      break;
  }
}
```

## UI Components

### Sponsor Button

```typescript
export default {
  ui: {
    sponsorButton: {
      variant: "modern",
      showCount: true
    }
  }
}
```

### Subscription Tiers

```typescript
export default {
  ui: {
    subscriptionTiers: {
      layout: "grid",
      showBenefits: true
    }
  }
}
```

## Integration Benefits

1. **Open Source Focus**
   - Built for open source projects
   - Community-driven features
   - Transparent funding

2. **GitHub Integration**
   - Repository linking
   - Issue tracking
   - Dependency insights

3. **Financial Tools**
   - Multiple currencies
   - Automatic payouts
   - Tax documentation

## Best Practices

### Setup

1. **Organization Profile**
   - Complete organization details
   - Add project description
   - Set up payment methods

2. **Subscription Tiers**
   - Clear benefit descriptions
   - Reasonable pricing
   - Multiple options

### Maintenance

1. **Community Management**
   - Regular updates
   - Sponsor recognition
   - Benefit delivery

2. **Financial Planning**
   - Track contributions
   - Plan sustainable pricing
   - Monitor growth

## Common Use Cases

### 1. Open Source Sponsorship

```typescript
// Example: Setting up sponsorship tiers
export default {
  payments: {
    polar: {
      subscriptions: {
        tiers: [
          {
            name: "Backer",
            amount: 5,
            description: "Support our work"
          },
          {
            name: "Maintainer",
            amount: 100,
            description: "Help sustain development"
          }
        ]
      }
    }
  }
}
```

### 2. Premium Features

```typescript
// Example: Check subscription status
const hasAccess = await polar.subscriptions.checkAccess({
  organization: "your-org",
  user: userId,
  feature: "premium"
});
```

### 3. Sponsor Recognition

```typescript
// Example: Display sponsor badge
<PolarBadge
  organization="your-org"
  user={userId}
  variant="modern"
/>
```

## Testing

1. **Development Mode**
   - Use test organization
   - Simulate subscriptions
   - Verify webhooks

2. **Production Checks**
   - Validate payments
   - Test benefit delivery
   - Monitor webhooks

## Migration

If you're moving from another platform:

1. **Data Export**
   - Export existing subscribers
   - Download payment history
   - Save benefit assignments

2. **Import Process**
   - Upload subscriber data
   - Recreate subscription tiers
   - Map existing benefits

3. **Communication**
   - Notify existing sponsors
   - Explain migration process
   - Provide support
