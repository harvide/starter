# Email Service

Harvide Starter provides a robust email service for handling transactional emails, notifications, and marketing communications.

## Configuration

### Provider Setup

Choose and configure your email provider in `starter.config.ts`:

```typescript
export default {
  email: {
    enabled: true,
    provider: "resend", // or "smtp"
    from: {
      admin: {
        email: "admin@example.com",
        name: "Admin Team"
      },
      support: {
        email: "support@example.com",
        name: "Support Team"
      },
      noReply: {
        email: "noreply@example.com"
      }
    }
  }
}
```

### Environment Variables

1. **Resend Configuration**
   ```dotenv
   RESEND_API_KEY=your_resend_api_key
   ```

2. **SMTP Configuration**
   ```dotenv
   SMTP_HOST=smtp.example.com
   SMTP_PORT=587
   SMTP_USER=your_username
   SMTP_PASSWORD=your_password
   ```

## Features

### Authentication Emails

- Email verification
- Password reset
- OTP codes
- Welcome emails
- Account updates

### Transactional Emails

- User notifications
- System alerts
- Status updates
- Action confirmations

### Marketing Emails

- Newsletters
- Product updates
- Announcements
- Promotional content

## Important Considerations

### Email Verification

When enabling email verification (`auth.emailAndPassword.requireEmailVerification`):
- Users must verify their email before accessing protected routes
- Verification links expire based on `verificationTokenExpiresIn`
- Failed verifications are logged and monitored

### Password Reset

When enabling password reset (`auth.emailAndPassword.sendResetPassword`):
- Reset tokens have configurable expiration
- Users receive secure reset links
- Multiple active reset tokens are handled properly

### Email OTP

When enabling OTP (`auth.emailAndPassword.otp.enabled`):
- OTP codes expire based on `otp.expiresIn`
- Failed attempts are limited by `otp.allowedAttempts`
- Rate limiting prevents abuse

## Provider-Specific Features

### Resend

- Modern API design
- Real-time analytics
- Delivery monitoring
- Spam protection

### SMTP

- Universal compatibility
- Custom server support
- Direct sending
- Self-hosted option

## Best Practices

### Security

1. **API Keys**
   - Store securely in environment variables
   - Rotate regularly
   - Use different keys for development/production

2. **Rate Limiting**
   - Implement sending limits
   - Monitor failed attempts
   - Prevent email abuse

3. **Content Security**
   - Validate email templates
   - Sanitize user input
   - Check spam scores

### Delivery

1. **Authentication**
   - Configure SPF records
   - Set up DKIM signing
   - Enable DMARC policy

2. **Monitoring**
   - Track delivery rates
   - Monitor bounce rates
   - Check spam placement

3. **Performance**
   - Use email queuing
   - Handle retries gracefully
   - Log delivery status

## Troubleshooting

### Common Issues

1. **Email Not Sending**
   - Check provider credentials
   - Verify rate limits
   - Check network connectivity

2. **Delivery Failures**
   - Verify recipient address
   - Check spam filters
   - Review bounce reports

3. **Template Issues**
   - Validate template syntax
   - Check variable replacement
   - Test in multiple clients

## Development Workflow

1. **Local Testing**
   ```bash
   # Test email sending
   bun run email:test

   # Preview templates
   bun run email:preview
   ```

2. **Template Development**
   - Use preview mode
   - Test all variables
   - Check responsiveness

3. **Production Deployment**
   - Verify provider settings
   - Test critical flows
   - Monitor initial sending

## Maintenance

### Regular Tasks

1. **Template Updates**
   - Review content
   - Update styling
   - Test changes

2. **Performance Monitoring**
   - Check delivery rates
   - Review error logs
   - Update configurations

3. **Security Reviews**
   - Audit access controls
   - Update dependencies
   - Review security settings
